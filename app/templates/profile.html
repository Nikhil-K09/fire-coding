{% extends 'base.html' %}

{% block content %}
<h2>Profile: {{ current_user.username }}</h2>
<p>Submission history:</p>

{% if submissions %}
<table class="submissions-table" border="1" cellspacing="0" cellpadding="8">
  <thead>
    <tr>
      <th>ID</th>
      <th>Problem</th>
      <th>Language</th>
      <th>Status</th>
      <th>Submitted At</th>
      <th>Output</th>
    </tr>
  </thead>
  <tbody>
    {% for sub in submissions %}
    <tr>
      <td>{{ sub['_id'] }}</td>
      <td>{{ sub['problem_title'] }}</td>
      <td>{{ sub['lang_name'] }}</td>
      <td>{{ sub['status'] }}</td>
      <td>{{ sub['submitted_at'] }}</td>
      <td>
        {% if sub.get('stdout') %}
        <button class="view-output-btn" data-output="{{ sub['stdout']|e }}">View</button>
        {% else %}
        -
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p>No submissions yet.</p>
{% endif %}

<!-- Modal for output -->
<div id="outputModal" style="display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%); background:#1e1e1e; color:#fff; padding:20px; border-radius:8px; max-width:90%; max-height:70%; overflow:auto; z-index:1000;">
  <pre id="modalContent"></pre>
  <button id="closeModal" style="margin-top:10px; padding:6px 12px;">Close</button>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const modal = document.getElementById("outputModal");
  const modalContent = document.getElementById("modalContent");
  const closeBtn = document.getElementById("closeModal");

  document.querySelectorAll(".view-output-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      modalContent.textContent = btn.dataset.output;
      modal.style.display = "block";
    });
  });

  closeBtn.addEventListener("click", () => {
    modal.style.display = "none";
  });

  // click outside modal to close
  window.addEventListener("click", (e) => {
    if (e.target === modal) modal.style.display = "none";
  });
});
</script>

<style>
.submissions-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

.submissions-table th, .submissions-table td {
  padding: 8px 12px;
  text-align: left;
}

.submissions-table th {
  background-color: #333;
  color: #fff;
}

.submissions-table tr:nth-child(even) {
  background-color: #2a2a2a;
}
.submissions-table tr:nth-child(odd) {
  background-color: #1e1e1e;
}

.view-output-btn {
  padding: 4px 8px;
  background-color: #007bff;
  border: none;
  border-radius: 4px;
  color: #fff;
  cursor: pointer;
}

.view-output-btn:hover {
  background-color: #0056b3;
}
</style>
{% endblock %}
